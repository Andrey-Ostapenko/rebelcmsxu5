<?xml version="1.0"?>
<!--
  For more information on how to configure your ASP.NET application, please visit
  http://go.microsoft.com/fwlink/?LinkId=152368
  -->

<configuration>
  <configSections>
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,log4net"/>
    <sectionGroup name="RebelCms">
      <section name="hive" type="RebelCms.Hive.Configuration.HiveConfigSection, RebelCms.Hive" requirePermission="false" restartOnExternalChanges="true" />
      <section name="pluginManager" type="RebelCms.Framework.Configuration.PluginManagerConfiguration, RebelCms.Framework" requirePermission="false" />
      <section name="membership" type="RebelCms.Hive.Providers.Membership.Config.ProviderConfigurationSection, RebelCms.Hive.Providers.Membership" requirePermission="false"/>
      <sectionGroup name="fileSystemProviderSettings">
        <section name="file-uploader" type="RebelCms.Hive.Providers.IO.ConfigSection, RebelCms.Hive.Providers.IO" requirePermission="false" />
        <section name="stylesheets" type="RebelCms.Hive.Providers.IO.ConfigSection, RebelCms.Hive.Providers.IO" requirePermission="false" />
        <section name="scripts" type="RebelCms.Hive.Providers.IO.ConfigSection, RebelCms.Hive.Providers.IO" requirePermission="false" />
        <section name="templates" type="RebelCms.Hive.Providers.IO.ConfigSection, RebelCms.Hive.Providers.IO" requirePermission="false" />
        <section name="partials" type="RebelCms.Hive.Providers.IO.ConfigSection, RebelCms.Hive.Providers.IO" requirePermission="false" />
        <section name="macros" type="RebelCms.Hive.Providers.IO.ConfigSection, RebelCms.Hive.Providers.IO" requirePermission="false" />
        <section name="macro-partials" type="RebelCms.Hive.Providers.IO.ConfigSection, RebelCms.Hive.Providers.IO" requirePermission="false" />
        <section name="stubs" type="RebelCms.Hive.Providers.IO.ConfigSection, RebelCms.Hive.Providers.IO" requirePermission="false" />
      </sectionGroup>
    </sectionGroup> 

    <sectionGroup name="RebelCms.cms">      
      <section name="languages" type="RebelCms.Cms.Web.Configuration.Languages.LanguagesConfiguration, RebelCms.Cms.Web" requirePermission="false"/>
      <section name="applications" type="RebelCms.Cms.Web.Configuration.ApplicationSettings.ApplicationConfiguration, RebelCms.Cms.Web" requirePermission="false"/>
      <section name="trees" type="RebelCms.Cms.Web.Configuration.ApplicationSettings.TreeConfiguration, RebelCms.Cms.Web" requirePermission="false"/>
      <section name="dashboard-groups" type="RebelCms.Cms.Web.Configuration.Dashboards.DashboardGroupConfiguration, RebelCms.Cms.Web" requirePermission="false"/>
      <section name="system" type="RebelCms.Cms.Web.Configuration.RebelCmsSystem.RebelCmsSystemConfiguration, RebelCms.Cms.Web" requirePermission="false" />      
    </sectionGroup>

    <section name="clientDependency" type="ClientDependency.Core.Config.ClientDependencySection, ClientDependency.Core" requirePermission="false"/>

  </configSections>

  <clientDependency configSource="App_Data\RebelCms\Config\ClientDependency.config"/>

  <appSettings>
    <add key="log4net.Config" value="App_Data\RebelCms\Config\log4net.config" />
    <!--<add key="RouteDebugger:Enabled" value="true"/>-->
    <add key="ClientValidationEnabled" value="true"/>
    <add key="UnobtrusiveJavaScriptEnabled" value="true"/>
  </appSettings>
  
  <log4net configSource="App_Data\RebelCms\Config\log4net.config" />

  <RebelCms>
    <hive configSource="App_Data\RebelCms\Config\RebelCms.hive.config" />
    <pluginManager pluginsFolder="~/App_Plugins" shadowCopyFolder="~/App_Plugins/bin" />
    <membership configSource="App_Data\RebelCms\Config\RebelCms.membership.config" />
    <fileSystemProviderSettings>
      <file-uploader supportedExtensions="*.jpg;*.gif;*.pdf;*.docx" excludedDirectories=".*" rootPath="~/Content/Media" />
      <stylesheets supportedExtensions="*.css" excludedDirectories=".*" rootPath="~/Content/Styles" />
      <scripts supportedExtensions="*.js" excludedDirectories=".*" rootPath="~/Scripts/RebelCms" />
      <templates supportedExtensions="*.cshtml" excludedDirectories=".*" rootPath="~/Views/RebelCms" />
      <partials supportedExtensions="*.cshtml" excludedDirectories=".*" rootPath="~/Views/RebelCms/Partial" />
      <macros supportedExtensions="*.macro" excludedDirectories=".*" rootPath="~/App_Data/RebelCms/Macros" />
      <macro-partials supportedExtensions="*.cshtml" excludedDirectories=".*" rootPath="~/Views/RebelCms/MacroPartials" />
      <stubs supportedExtensions="*" excludedDirectories=".*" rootPath="~/App_Data/RebelCms/Stubs" />
    </fileSystemProviderSettings>    
  </RebelCms>

  <RebelCms.cms>
    <languages configSource="App_Data\RebelCms\Config\RebelCms.cms.languages.config" />
    <applications configSource="App_Data\RebelCms\Config\RebelCms.cms.applications.config" />
    <trees configSource="App_Data\RebelCms\Config\RebelCms.cms.trees.config" />
    <dashboard-groups configSource="App_Data\RebelCms\Config\RebelCms.cms.dashboards.config" />
    <system configSource="App_Data\RebelCms\Config\RebelCms.cms.system.config" />
  </RebelCms.cms>

  <connectionStrings>
  </connectionStrings>

  <system.web>
    <caching>
      <outputCacheSettings>
        <outputCacheProfiles>
          <!-- Micro-caching technique to ward against peak traffic. "RebelCms-default" profile is used by RebelCmsController, the default controller used for regular pages -->
          <add name="RebelCms-default" duration="1" varyByParam="*" location="ServerAndClient"/>
        </outputCacheProfiles>
      </outputCacheSettings>
    </caching>
    
    <httpRuntime requestValidationMode="2.0" />

    <compilation debug="true" targetFramework="4.0">
      <assemblies>
        <add assembly="System.Web.Abstractions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add assembly="System.Web.Helpers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add assembly="System.Web.Routing, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add assembly="System.Web.Mvc, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add assembly="System.Web.WebPages, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
      </assemblies>
    </compilation>

    <authentication mode="Forms">
    </authentication>

    <membership defaultProvider="BackOfficeMembershipProvider">
      <providers>
        <clear/>
        <add name="BackOfficeMembershipProvider" type="RebelCms.Cms.Web.Security.BackOfficeMembershipProvider" passwordFormat="Clear" />
      </providers>
    </membership>

    <profile>
      <providers>
        <clear/>
      </providers>
    </profile>

    <roleManager enabled="true" defaultProvider="BackOfficeRoleProvider">
      <providers>
        <clear/>
        <add name="BackOfficeRoleProvider" type="RebelCms.Cms.Web.Security.BackOfficeRoleProvider" />
      </providers>
    </roleManager> 

    <pages validateRequest="false" >
      <namespaces>
        <add namespace="System.Linq" />
        <add namespace="System.Web.Helpers" />
        <add namespace="System.Web.Mvc" />
        <add namespace="System.Web.Mvc.Ajax" />
        <add namespace="System.Web.Mvc.Html" />
        <add namespace="System.Web.Routing" />
        <add namespace="System.Web.WebPages"/>
        <add namespace="ClientDependency.Core" />
        <add namespace="ClientDependency.Core.Mvc" />
        <add namespace="RebelCms.Cms.Web" />
        <add namespace="RebelCms.Cms.Web.Context" />
        <add namespace="RebelCms.Cms.Web.Editors" />
        <add namespace="RebelCms.Cms.Web.EmbeddedViewEngine" />
        <add namespace="RebelCms.Framework"/>
        <add namespace="RebelCms.Hive"/>
        <add namespace="RebelCms.Framework.Localization"/>
        <add namespace="RebelCms.Cms.Web.Model" />
        <add namespace="RebelCms.Cms.Web.Model.BackOffice" />
        <add namespace="RebelCms.Cms.Web.Model.BackOffice.Editors" />
      </namespaces>
    </pages>

    <httpModules>
      <add name="BackOfficeAuthenticationModule" type="RebelCms.Cms.Web.Security.BackOfficeAuthenticationModule, RebelCms.Cms.Web"/>
      <add name="ClientDependencyModule" type="ClientDependency.Core.Module.ClientDependencyModule, ClientDependency.Core"/>
    </httpModules>
    <httpHandlers>
      <add verb="*" path="DependencyHandler.axd" type="ClientDependency.Core.CompositeFiles.CompositeDependencyHandler, ClientDependency.Core "/>
    </httpHandlers>

    <!-- ENABLE THIS TO TEST IN MED TRUST -->
    <!--<trust level="Medium"/>-->
    <trace enabled="true" pageOutput="false" mostRecent="true" traceMode="SortByTime" requestLimit="50"/>
  </system.web>

  <system.webServer>
    <validation validateIntegratedModeConfiguration="false"/>
    <modules runAllManagedModulesForAllRequests="true">
      <!-- Disable WebDAV publishing for this application. The RebelCms backoffice uses the DELETE http verb for item deletions, and the default WebDAV configuration returns 405 Method Not Allowed -->
      <remove name="WebDAVModule" />
      <remove name="BackOfficeAuthenticationModule"/>
      <add name="BackOfficeAuthenticationModule" type="RebelCms.Cms.Web.Security.BackOfficeAuthenticationModule, RebelCms.Cms.Web"/>
      <remove name="ClientDependencyModule"/>
      <add name="ClientDependencyModule" type="ClientDependency.Core.Module.ClientDependencyModule, ClientDependency.Core"/>
    </modules>
    <handlers>
      <remove name="DependencyHandler"/>
      <!-- Disable WebDAV publishing for this application. The RebelCms backoffice uses the DELETE http verb for item deletions, and the default WebDAV configuration returns 405 Method Not Allowed -->
      <remove name="WebDAV" />
      <add name="DependencyHandler" preCondition="integratedMode" verb="*" path="DependencyHandler.axd" type="ClientDependency.Core.CompositeFiles.CompositeDependencyHandler, ClientDependency.Core "/>
    </handlers>
  </system.webServer>

  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <probing privatePath="App_Plugins/bin;" />
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Mvc" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="1.0.0.0-2.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Castle.Core" />
        <bindingRedirect oldVersion="1.0.0.0-2.0.0.0" newVersion="2.5.2.0" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime>

  <!-- custom config for the RebelCms back office -->
  <location path="RebelCms">
    <system.web>
      <customErrors mode="Off" defaultRedirect="Default/Error" >
      </customErrors>
    </system.web>
  </location>

</configuration>

